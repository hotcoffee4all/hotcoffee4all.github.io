
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wind Budget Calculator</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    label { display: block; margin-top: 10px; }
    input, button { width: 100%; padding: 10px; margin-top: 5px; font-size: 16px; }
    .output, .debug { margin-top: 20px; background: white; padding: 15px; border-radius: 8px; }
    button { background: #007bff; color: white; border: none; }
    button:active { background: #0056b3; }
  </style>
</head>
<body>

<h2>Wind Budget & Density Altitude</h2>

<label>Target Size (inches)</label>
<input id="targetSize" type="number" step="0.1">

<label>Distance (yards)</label>
<input id="distance" type="number" step="1">

<label>Wind Hold (mils)</label>
<input id="windHold" type="number" step="0.01">

<label>Temperature (°F)</label>
<input id="temperature" type="number">

<label>Pressure (hPa)</label>
<input id="pressure" type="number">

<label>Humidity (%)</label>
<input id="humidity" type="number">

<label>Elevation (feet)</label>
<input id="elevation" type="number">

<button onclick="autoFill()">Auto-Fill Weather</button>
<button onclick="calculate()">Calculate</button>

<div class="output" id="result">Results appear here…</div>
<div class="debug" id="debug">Debug log…</div>

<script>
function log(msg) {
  document.getElementById("debug").textContent += "\n" + msg;
}

function autoFill() {
  if (!navigator.geolocation) {
    log("Geolocation not supported.");
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    log("Loc: " + lat.toFixed(4) + ", " + lon.toFixed(4));
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relative_humidity_2m,surface_pressure&timezone=auto`;
    fetch(url).then(res => res.json()).then(data => {
      const now = data.current_weather.time;
      const hourIndex = data.hourly.time.indexOf(now);
      const rh = data.hourly.relative_humidity_2m[hourIndex];
      const sp = data.hourly.surface_pressure[hourIndex];
      const tempC = data.current_weather.temperature;
      document.getElementById("temperature").value = (tempC * 9/5 + 32).toFixed(1);
      document.getElementById("pressure").value = sp.toFixed(1);
      document.getElementById("humidity").value = rh.toFixed(1);
      document.getElementById("elevation").value = "0";
      log("Weather updated.");
    }).catch(e => log("Fetch error: " + e));
  }, err => log("Geo error: " + err.message));
}

function calculate() {
  const size = parseFloat(document.getElementById("targetSize").value);
  const dist = parseFloat(document.getElementById("distance").value);
  const hold = parseFloat(document.getElementById("windHold").value);
  const temp = parseFloat(document.getElementById("temperature").value);
  const press = parseFloat(document.getElementById("pressure").value);
  const hum = parseFloat(document.getElementById("humidity").value);
  const elev = parseFloat(document.getElementById("elevation").value);

  if ([size, dist, hold, temp, press, hum, elev].some(isNaN)) {
    alert("Fill all fields.");
    return;
  }

  const targetMIL = (size / 36) / (dist / 1000);
  const budget = targetMIL / 2;
  const error = budget - hold;
  const DA = (145366.45 * (1 - Math.pow((press / 1013.25), 0.190284))) + (elev || 0);

  document.getElementById("result").textContent =
    `Target MILs: ${targetMIL.toFixed(3)}\n` +
    `Wind Budget: ±${budget.toFixed(3)} mils\n` +
    `Safe Wind Call Error: ±${error.toFixed(3)} mils\n` +
    `Density Altitude: ${DA.toFixed(0)} ft`;
}
</script>

</body>
</html>
