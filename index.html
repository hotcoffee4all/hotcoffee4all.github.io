
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wind Budget Calculator with Live Weather</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        label { display: block; margin-top: 10px; }
        input[type=number], input[type=text] { width: 100%; padding: 8px; margin-top: 5px; }
        button { padding: 10px 20px; margin-top: 15px; }
        .output { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Wind Budget Calculator</h1>

    <label for="targetSize">Target Size (inches):</label>
    <input type="number" id="targetSize" step="0.1">

    <label for="distance">Distance to Target (yards):</label>
    <input type="number" id="distance" step="1">

    <label for="windHold">Your Wind Hold (mils):</label>
    <input type="number" id="windHold" step="0.01">

    <label for="windSpeed">Wind Speed (mph):</label>
    <input type="number" id="windSpeed" step="0.1">

    <label for="windDirection">Wind Direction (° from north):</label>
    <input type="number" id="windDirection" step="1">

    <label for="temperature">Temperature (°F):</label>
    <input type="number" id="temperature" step="0.1">

    <label for="pressure">Pressure (hPa):</label>
    <input type="number" id="pressure" step="0.1">

    <label for="humidity">Humidity (%):</label>
    <input type="number" id="humidity" step="0.1">

    <button onclick="calculateWindBudget()">Calculate</button>
    <button onclick="getWeather()">Auto-Fill Weather</button>

    <div class="output" id="outputArea"></div>

    <script>
        function calculateWindBudget() {
            const targetSize = parseFloat(document.getElementById('targetSize').value);
            const distance = parseFloat(document.getElementById('distance').value);
            const windHold = parseFloat(document.getElementById('windHold').value);

            if (isNaN(targetSize) || isNaN(distance) || isNaN(windHold)) {
                document.getElementById('outputArea').innerText = 'Please fill in all required fields.';
                return;
            }

            const targetSizeMIL = (targetSize / 36) / (distance / 1000);
            const windBudget = targetSizeMIL / 2;
            const windError = windBudget - windHold;

            document.getElementById('outputArea').innerText = 
                `Target Size: ${targetSizeMIL.toFixed(3)} mils\n` +
                `Wind Budget: ±${windBudget.toFixed(3)} mils\n` +
                `Safe Wind Call Error: ±${windError.toFixed(3)} mils`;
        }

        function getWeather() {
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser.");
                return;
            }

            navigator.geolocation.getCurrentPosition(position => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,pressure_msl,wind_speed_10m,wind_direction_10m,relative_humidity_2m`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        const current = data.current;
                        document.getElementById('temperature').value = (current.temperature_2m * 9/5 + 32).toFixed(1);
                        document.getElementById('pressure').value = (current.pressure_msl).toFixed(1);
                        document.getElementById('windSpeed').value = current.wind_speed_10m.toFixed(1);
                        document.getElementById('windDirection').value = current.wind_direction_10m.toFixed(0);
                        document.getElementById('humidity').value = current.relative_humidity_2m.toFixed(1);
                    })
                    .catch(error => {
                        alert("Failed to retrieve weather data.");
                        console.error(error);
                    });

            }, () => {
                alert("Unable to retrieve your location.");
            });
        }
    </script>
</body>
</html>
