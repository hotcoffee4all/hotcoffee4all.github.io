
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wind Budget Calculator</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-color: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 1.6em;
      margin-bottom: 20px;
    }
    label {
      font-weight: 500;
      margin-top: 10px;
      display: block;
    }
    input[type=number] {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    button:active {
      background-color: #0056b3;
    }
    .output, .debug {
      margin-top: 20px;
      font-size: 1em;
      white-space: pre-wrap;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .debug {
      color: #6c757d;
      font-size: 0.9em;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Wind Budget Calculator</h1>

  <label for="targetSize">Target Size (inches):</label>
  <input type="number" id="targetSize" step="0.1">

  <label for="distance">Distance to Target (yards):</label>
  <input type="number" id="distance" step="1">

  <label for="windHold">Your Wind Hold (mils):</label>
  <input type="number" id="windHold" step="0.01">

  <label for="windSpeed">Wind Speed (mph):</label>
  <input type="number" id="windSpeed" step="0.1">

  <label for="windDirection">Wind Direction (° from north):</label>
  <input type="number" id="windDirection" step="1">

  <label for="temperature">Temperature (°F):</label>
  <input type="number" id="temperature" step="0.1">

  <label for="pressure">Pressure (hPa):</label>
  <input type="number" id="pressure" step="0.1">

  <label for="humidity">Humidity (%):</label>
  <input type="number" id="humidity" step="0.1">

  <button onclick="getWeather()">Auto-Fill Weather</button>
  <button onclick="calculateWindBudget()">Calculate</button>

  <div class="output" id="outputArea">Output will appear here...</div>
  <div class="debug" id="debugLog">Debug log...</div>

  <script>
    function logDebug(message) {
      document.getElementById('debugLog').textContent += "\n" + message;
    }

    function calculateWindBudget() {
      const targetSize = parseFloat(document.getElementById('targetSize').value);
      const distance = parseFloat(document.getElementById('distance').value);
      const windHold = parseFloat(document.getElementById('windHold').value);

      if (isNaN(targetSize) || isNaN(distance) || isNaN(windHold)) {
        document.getElementById('outputArea').innerText = 'Please fill in all required fields.';
        return;
      }

      const targetSizeMIL = (targetSize / 36) / (distance / 1000);
      const windBudget = targetSizeMIL / 2;
      const windError = windBudget - windHold;

      document.getElementById('outputArea').innerText =
        `Target Size: ${targetSizeMIL.toFixed(3)} mils\n` +
        `Wind Budget: ±${windBudget.toFixed(3)} mils\n` +
        `Safe Wind Call Error: ±${windError.toFixed(3)} mils`;
    }

    function getWeather() {
      document.getElementById('debugLog').textContent = "Requesting location...";
      if (!navigator.geolocation) {
        alert("Geolocation is not supported by your browser.");
        return;
      }

      navigator.geolocation.getCurrentPosition(position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        logDebug(`Location acquired: Lat ${lat}, Lon ${lon}`);

        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,pressure_msl,wind_speed_10m,wind_direction_10m,relative_humidity_2m`;

        fetch(url)
          .then(response => response.json())
          .then(data => {
            const current = data.current;
            document.getElementById('temperature').value = (current.temperature_2m * 9/5 + 32).toFixed(1);
            document.getElementById('pressure').value = (current.pressure_msl).toFixed(1);
            document.getElementById('windSpeed').value = current.wind_speed_10m.toFixed(1);
            document.getElementById('windDirection').value = current.wind_direction_10m.toFixed(0);
            document.getElementById('humidity').value = current.relative_humidity_2m.toFixed(1);
            logDebug("Weather data retrieved successfully.");
          })
          .catch(error => {
            logDebug("Weather fetch failed: " + error.message);
          });

      }, (error) => {
        logDebug("Geolocation failed: " + error.message);
      });
    }
  </script>
</body>
</html>
